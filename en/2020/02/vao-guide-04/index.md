# VAO Basics (Part 4) – Core Components · Part 2


## Series Index

- [VAO Basics (1) – Introduction](https://blog.backupnext.cloud/_posts/2020-02-17-VAO-Guide-01/)
- [VAO Basics (2) – Installation & Deployment](https://blog.backupnext.cloud/_posts/2020-02-18-VAO-Guide-02/)
- [VAO Basics (3) – Core Components · Part 1](https://blog.backupnext.cloud/_posts/2020-02-19-VAO-Guide-03/)
- [VAO Basics (4) – Core Components · Part 2](https://blog.backupnext.cloud/_posts/2020-02-20-VAO-Guide-04/)
- [VAO Basics (5) – Key Configuration Points](https://blog.backupnext.cloud/_posts/2020-02-21-VAO-Guide-05/)
- [VAO Basics (6) – The First Step of a Successful DR Plan](https://blog.backupnext.cloud/_posts/2020-02-25-VAO-Guide-06/)
- [VAO Basics (7) – Plan Step · Part 1](https://blog.backupnext.cloud/_posts/2020-02-27-VAO-Guide-07/)
- [VAO Basics (8) – Plan Step · Part 2](https://blog.backupnext.cloud/_posts/2020-02-28-VAO-Guide-08/)
- [VAO Basics (9) – Document Template Deep Dive](https://blog.backupnext.cloud/_posts/2020-03-02-VAO-Guide-09/)

## Plan Components

The following components must be configured for each scope. Part 3 showed you where to edit them; now we’ll discuss what each component is and how to configure it.

#### VM Groups

VM Groups define which VMs a scope is allowed to operate on. In other words, they draw the boundary of “which virtual machines belong to this scope, and which production VMs will our Orchestration Plans touch.”

Unlike simple “check a VM” workflows, VAO does not let you freely select VMs inside the product. Instead, VM groups come from Veeam ONE’s Business View engine, which is tightly integrated with VAO and provides the classification logic. See the docs for details:

- <https://helpcenter.veeam.com/docs/vao/categorization/about.html?ver=20>
- <https://helpcenter.veeam.com/docs/one/monitor/bv_categorization_model.html?ver=100>

Business View recognizes three approaches:

```
1. vSphere tags  
2. Import via .CSV  
3. Custom Business View categorization policies
```

None is inherently superior; pick what your admins feel comfortable with.

##### vSphere Tags

This grouping method needs to be performed in vSphere. By applying different tags to different VMs, VMs with the same tag name will be grouped into the same VM Group, and the name of this VM Group will be the tag name from vSphere.

This grouping method cannot be modified in the Veeam system - it only needs to be operated in vSphere. After the operation is complete, VAO will receive the operation results after a short wait. This operation is fully automatic synchronization.

##### Import via .CSV

This can be done manually or automatically. This operation needs to be performed on the embedded Veeam ONE in VAO. Open the Veeam ONE Monitor console, and you can find the Business View tab in Server Settings. Here you will find options for automatic synchronization from CSV files and manual one-time import from CSV files.

It should be noted that the grouping method imported this way requires proper organization of the CSV file structure. The structure is as shown in the following table:

| Server       | ObjectType     | MoRef | Category1 |
| ------------ | -------------- | ----- | --------- |
| server.local | VirtualMachine | vm-01 | Group1    |
| server.local | VirtualMachine | vm-02 | Excluded  |

This CSV file can be created and updated manually, or generated by third-party systems.

Personally, I think this method is rather rigid and not very easy to use.

##### Custom Business View policies

Inside Business View, right-click and choose **Add Category** to launch the policy wizard, which can build groups based on attributes. In practice the conditions aren’t as flexible as we’d like, so most environments still land on vSphere tags.

Therefore, I still recommend everyone to use vSphere Tags for grouping. After completing the operation in vSphere, you just need to wait for a while, and the relevant VM Groups will appear in VAO. As shown in the figure below:

![3E8owV.png](https://s2.ax1x.com/2020/02/19/3E8owV.png)

Here, the naming combination of VM Groups is *vSphere Tags Category Name* - *vSphere Tag Name*. Therefore, we see that the VAO Backup tag in vSphere is displayed as VAO Tags Group - VAO Backup in the VM Groups in VAO. After selecting this VM Group, you can see the list of virtual machines included in this VM Group on the right side of the screen. Click the Include button above to add this VM Group to the currently selected Scope.

#### Recovery Locations

Recovery Locations are the physical computing resources that our Orchestration Plan will use during recovery, including the three core resources: Compute, Storage, and Network. When converted to vSphere, they have the following corresponding relationships:

| VAO Recovery Locations name | vSphere resources              |
| -------------------------- | ------------------------ |
| Compute                    | ESXi、Cluster            |
| Storage                    | Datastore                |
| Network                    | Port group names on virtual switches |

In VAO, just like selecting VM Groups, we cannot directly select a specific ESXi or Datastore as our Recovery Location. We can only obtain them through the Business View engine embedded in Veeam ONE. Similar to the VM Group settings above, we can group ESXi or Cluster and Datastore through vSphere Tags. After grouping is complete, VAO can read this information. It's slightly more complicated - this information also needs to be arranged in a certain order through the Recovery Locations addition wizard to ensure the corresponding relationship between ESXi, Datastore and port groups on virtual switches.

Recovery Locations are set in Recovery Locations under Configuration in Administration. After entering this setting interface, you will see that VAO has built a default Recovery Location, which is to restore to the original location of the virtual machine. For this default Recovery Location, we can only edit it and cannot delete it. The content that can be adjusted by editing operations is also very limited.

We can create new Recovery Locations for restoring to a new location. We can create multiple Recovery Locations here. Through the Add button, we can open the addition wizard:

1. In Location Info, you only need to fill in the name and description.
   ![3ENar9.png](https://s2.ax1x.com/2020/02/19/3ENar9.png)

2. In the Compute Resources selection step, select the appropriate ESXi or Cluster corresponding Tags and click Add to add them to this Recovery Location. Of course, the content display here is not very intuitive. VAO provides a view button. Click the View Resource button on the right to see the ESXi or Cluster included under this Tags. If the Tags here are assigned to a certain Cluster, then in View Resources you can only see the name of the Cluster, and when actually executing the plan, VAO needs the Cluster's DRS policy to decide which ESXi Host to place the recovered VM on.
   ![3ENy8O.png](https://s2.ax1x.com/2020/02/19/3ENy8O.png)

3. In the Storage Resources selection step, please be very careful in your selection. One rather unintelligent point in VAO is that even though this page already prompts "Only Storage resources available to the previously selected Compute resources are shown here", Storage Resources will still list some unrelated Storage Groups. They are just not displayed with green checkmarks on the left, but with a green half-circle plus a white half-circle, which means they are partially available for the above Compute Resource. What we need to do is ensure that the selected Storage Group displays a green checkmark, meaning it must be completely available for the Compute Resources selected in the previous layer to avoid various warnings and failures in subsequent Orchestration Plans.
   ![3EN62D.png](https://s2.ax1x.com/2020/02/19/3EN62D.png)

4. Resource Usage, set the upper limit of storage resource usage to ensure storage resources are not exhausted.
   ![3ENcxe.png](https://s2.ax1x.com/2020/02/19/3ENcxe.png)

5. Instant VM Recovery, select whether to enable IVR.
   ![3ENdbR.png](https://s2.ax1x.com/2020/02/19/3ENdbR.png)

6. Re-IP Rules, VAO has a built-in function to modify IP addresses after disaster recovery or failover. When we need to change the IP of the recovered system, we can use the Re-IP Rules here to modify it. According to the rules set here, VAO automatically applies this rule to systems that meet the conditions. The setting of this rule is also very simple. It can be a one-to-one correspondence of IP subnets. In other words, it only changes the subnet of the corresponding system, while the last digit of the address is not changed. For example, if the address of the source virtual machine is 10.10.1.25, and the corresponding rule is to change from 10.10.1.x to 10.10.3.x, then the result of this change is 10.10.3.25.

   Of course, this can also be single IP address Re-Mapping.
   ![3ENsPK.png](https://s2.ax1x.com/2020/02/19/3ENsPK.png)

7. In Network Mapping, you can set the port groups of source VMs to the port groups that need to be used for disaster recovery failover. This will list all port groups from both the source vCenter and the target vCenter. We only need to select the one-to-one correspondence relationship, unlike the previous Compute and Storage which require setting Tags in vSphere to achieve.
   ![3END56.png](https://s2.ax1x.com/2020/02/19/3END56.png)

After new locations are created, return to **Plan Components** and include the relevant locations per scope:

![3EwBOe.png](https://s2.ax1x.com/2020/02/19/3EwBOe.png)

#### Plan Steps

Plan Steps are reusable building blocks that VAO combines when executing a plan. The product includes a wide array of built-in steps (power operations, scripts, waits, checkpoints, etc.), and you can add your own in **Administration → Configuration → Plan Steps**. Once defined, switch back to **Plan Components → Plan Steps** and check **Include** for each step you want available in a scope.

![3EBSv8.png](https://s2.ax1x.com/2020/02/19/3EBSv8.png)

#### Credentials

Plan execution often needs OS-level credentials. VAO automatically inherits every credential stored in VBR; you can also create new ones by clicking **Add**. Then, under **Plan Components → Credentials**, select the appropriate scope and click **Include** so those credentials become available to that scope’s plans.

![3EsxoQ.png](https://s2.ax1x.com/2020/02/19/3EsxoQ.png)

#### Template Jobs

After VAO completes disaster recovery failover and disaster recovery, it can immediately protect the newly recovered systems at the first opportunity, ensuring that the system is in a protected state at the first time. This function requires VAO to have a template of a VBR backup job as a reference. In each Scope, you can set the Template Job that needs to be used. This Template Job is not set in VAO; it is directly obtained from VBR. The acquisition rule is also very simple: as long as the Description of the job in VBR's Backup Job contains **[VAO TEMPLATE]**, it can be correctly acquired by VAO.

The above are all the basic components of VAO. Thank you for reading and following.

