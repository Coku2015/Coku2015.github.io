---
layout: post
title: Veeam 备份服务器升级指南
tags: VBR
---

## 前言

2 月 25 日，Veeam 推出全新的 v11 版本，在去年，我曾经写过一篇升级到 v10 的帖子，其实本次 v11 的升级和之前的 v10 升级没有太多的差别，今天的内容，我将之前的这个帖子提到的做一些针对 v11 的调整，算是一些些小更新吧。

### 升级前

请按照下面的流程图检查当前环境，在升级 VBR 之前确保其他组件已经正常升级。

[![6EuJ78.png](https://s3.ax1x.com/2021/03/03/6EuJ78.png)](https://imgtu.com/i/6EuJ78)

v11 完全兼容之前 v10 的 VUL 许可，因此已经在使用 VUL 许可的，可以完全不需要准备或者导入许可文件。

### 升级方式

可以采用两种方式升级，没有太大区别。

1. 在原 VBR 服务器上原地升级；
2. 全新安装一台 VBR 服务器，然后将 Configuration Backup File 还原至这台全新安装的 VBR 中。

由于第二种方式和全新安装几乎没有任何区别，因此本文不详细展开讨论，而只讨论第一种原地升级方式。

### 升级准备

准备好 Veeam 升级介质，Veeam 的产品非常简单，升级介质和全新安装使用同一个介质包，只需要把产品包挂载到 VBR 服务器上即可。在执行 Upgrade 之前，需要做一系列准备工作：

1. 仔细阅读 Release Notes，检查自己环境，看看是否有不支持的系统。

 ```
  	- VMware vSphere 5.1 以及之前的版本
  	- Windows 2003 和 XP
  	- Microsoft SQL Server 2005
 ```

2. 使用 Veeam Configuration Backup 功能，将 VBR 的配置做一个备份，这个备份请确保是用 Encrypted 模式，这样所有在 VBR 中使用的用户名和密码将会妥善的被保存在。bco 文件中。
3. 检查 VBR 上面的所有备份作业，确保没有任何作业正在运行，这里要特别注意如下作业，需要手工点击 Disable 来停止：

```
    - Backup Copy Job
    - SQL、Oracle 的日志备份作业
```

​		看看是否有 Instant VM Recovery 正在运行；

​		看看是否有 Veeam Explorer 正处于打开并在执行恢复；

​		看看是否有 Surebackup/Virtual Lab 正在运行。

最终，所有任务都停止后，会是如下图状态：

![1L7jrd.png](https://s2.ax1x.com/2020/02/13/1L7jrd.png)

### 升级过程

整个升级过程非常简单，只需要按照向导点击几下鼠标，然后静静的等待 30 分钟以后，软件就能升级完成，因此在这里我就不详细去一步一步说明这个过程了。

### 可能碰到的问题

1. 升级过程中，升级包会首先停止 VBR 的所有服务，有可能碰到停止服务超时或者失败，导致升级过程中断，建议碰到失败后首先检查下 Services.msc 中 veeam 开头的服务是否被正常停止。
2. 服务都正常停止后，原地升级如果还报错，建议可以把 VBR 服务器重启一下后，再尝试升级，这里特别注意一下，在 VBR 重启后，需要重新检查所有 VBR 的作业，确保没有作业在自动运行。
3. 如果尝试多次都无法进行正常升级，建议使用上面提到的方法二，全新安装一台 VBR，然后将 Configuration backup 文件导入。
4. 如果以上方法全部失败，请及时联系 Veeam Support 团队，我们的攻城狮将会及时为您提供升级支持。

以上就是升级的一些小提示，感谢阅读！
