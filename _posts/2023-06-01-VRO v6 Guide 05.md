---
layout: post
title: VRO基础入门（六） -  成功灾备计划的第一步
tags: VAO, VRO
---

## 系列目录：

- [VRO基础入门（一）-  简介](https://blog.backupnext.cloud/_posts/2023-05-24-VRO-v6-Guide-01/)
- [VRO基础入门（二）-  安装与部署](https://blog.backupnext.cloud/_posts/2023-05-25-VRO-v6-Guide-02/)
- [VRO基础入门（三）-  基本组件 · 上篇](https://blog.backupnext.cloud/_posts/2023-05-26-VRO-v6-Guide-03/)
- [VRO基础入门（四）-  基本组件 · 下篇]
- [VRO基础入门（五）-  成功灾备计划的第一步]
- [VRO基础入门（六）-  数据实验室]
- [VRO基础入门（七）-  Plan Step  · 上篇]
- [VRO基础入门（八）-  Plan Step  · 下篇]
- [VRO基础入门（九）-  文档模板解析]
- [VRO基础入门（十）- 使用VRO搭配K10实现全自动容器灾备]



通过之前的配置，我们的VRO就可以开始正常使用了，我们可以用Administrator或者Plan Authors角色的用户登入到VRO控制台。在控制台中，可以访问VRO定制的仪表盘，包括灾备的执行计划（Plan）、灾备的状态检查（Readiness Check）、灾备测试情况（Datalab Testing）以及灾备的SLA（RPO和RTO情况）。

在主控制台中，管理员还能查看基础架构清单，根据各个角色定义的内容，分别能够从Inventory中查看到自己所管理的机器（Group）以及自己的灾备环境（Recovery Location）。

接下去，我来介绍下VRO的最主要的能力和具体的使用方法 - Orchestration Plan。

## 创建Orchestration Plan的方法

我们在最开始的简介中有提到过，Orchestration Plan有五大类，所有自动化的操作过程都将会通过这个Plan加入到灾备中去。在这里，我建议首先第一步，尽可能的不要加入太复杂的自动化脚本，而是用系统自带的Plan Steps，用最少的流程来认识这些Plan，等到熟悉了系统的工作机制后，再来逐步逐步添加适合的自定义脚本。

操作步骤：

1. 创建Orchestration Plan，进入左边的Orchestration Plans，在右边内容显示区域，会看到顶部的一排4个按钮，其中在Manage按钮所在的下拉菜单中，可以找到New的按钮。通过这个按钮可以启动Orchestration Plan的创建向导。
[![p9zkvDO.png](https://s1.ax1x.com/2023/06/01/p9zkvDO.png)](https://imgse.com/i/p9zkvDO)

2. 打开向导后，首先需要设定Plan Info，此处的内容一般来说按照实际的情况填写，这些都会在Report中被使用到。
[![p9zAF2t.png](https://s1.ax1x.com/2023/06/01/p9zAF2t.png)](https://imgse.com/i/p9zAF2t)

3. 在向导的Scope步骤中，需要选取使用哪个Scope来创建这个Orchestration Plan，就像基础组件中提到，每个Scope中包含了灾备的一系列元素，而Orchestration Plan则是把这些元素组合起来，形成一个可执行的计划，Scope的选择决定了哪些用户可以访问这个Plan。今天的例子中，我们选择Admin这个Scope。
[![p9zAi8I.png](https://s1.ax1x.com/2023/06/01/p9zAi8I.png)](https://imgse.com/i/p9zAi8I)

4. 在向导的Plan Type步骤中，就可以选择5大分类的其中一种，今天的例子中，我们选择Restore进入下一步，其余的一些选项在后面的向导中会略有不同，留给大家自行探索。
[![p9zAPPA.png](https://s1.ax1x.com/2023/06/01/p9zAPPA.png)](https://imgse.com/i/p9zAPPA)

5. 在向导的Recovery Location步骤中，选择一个DR的Location，我们将会把我们备份的机器恢复至DR站点的ESXi中。关于Recovery Location的设定，可以参考上一期的内容。
[![p9zApUH.png](https://s1.ax1x.com/2023/06/01/p9zApUH.png)](https://imgse.com/i/p9zApUH)

6. 在向导的VM Group步骤中，当前Scope下能看到的所有可用VM Groups都会列在Available Group中，通过Add按钮将需要的Group添加至右边的Plan Groups窗格中。也可以通过View VMs来详细查看当前选定的VM Groups中所包含的VM。
[![p9zASVe.png](https://s1.ax1x.com/2023/06/01/p9zASVe.png)](https://imgse.com/i/p9zASVe)

7. 在VM Recovery Options步骤中，需要设置四个内容：
   - If any VM recovery fails then：如果Plan中有多台VM需要恢复，假如其中有一台VM恢复失败，此选项决定了后续的Plan如何操作，可以继续执行计划恢复其他VM或者是直接停止计划。
   - Recover the VMs in each Group: 按顺序恢复还是同时恢复。如果选择In parallel是同时进行，如果是选择In Sequence则是按顺序执行。
   - Recover simultaneously max of VMs：选择合适的数量，默认是10个，一般来说，管理员需要根据自己的计算资源情况，合理选择，最好执行一些测试后最后决定这里的数量。
   - Restore VM Tags：这个复选框下有个⚠️，一般来说恢复至新位置成为一个新VM则大多是不会选择这个恢复Tags，避免和生产的VM混起来。

   [![p9zkxbD.png](https://s1.ax1x.com/2023/06/01/p9zkxbD.png)](https://imgse.com/i/p9zkxbD)

8. 在VM Steps步骤中，可以选择很多恢复过程中的可以用到的Steps，默认情况下，系统自动会选上Restore VM和Check VM Heartbeat这两个Step。我建议刚开始熟悉VRO的管理员逐项逐项的添加各种Step，以测试每一种操作的功能，确定了某个需要的Step之后，再将其设计到自己的最终Plan之中。在这个步骤中，管理员可以加入各种各样的自定义Powershell脚本，借助这样的扩展，管理员可以灵活的控制和管理各种各样的系统。
[![p9zA95d.png](https://s1.ax1x.com/2023/06/01/p9zA95d.png)](https://imgse.com/i/p9zA95d)

9. 在Protect VM Groups步骤中，可以加入自动化的保护恢复出来的灾备资源设置，这步操作对于全自动运行的灾备系统非常重要，确保了对灾备恢复后的下一步保护。今天的例子中，我们暂时保持这个选项默认，不做选择，进入下一步。
[![p9zkLgx.png](https://s1.ax1x.com/2023/06/01/p9zkLgx.png)](https://imgse.com/i/p9zkLgx)

10. 在RPO和RTO步骤中，管理员可以设定期望的SLA，VRO系统会全自动的去监控备份系统和灾备系统，确保管理员期望的RPO和RTO。当出现任何不符合预期的状况，VRO将会通过告警通知提醒管理员进行进一步处理。在个步骤我们也保持默认数值，1小时的RTO,24小时的RPO。
[![p9zkq81.png](https://s1.ax1x.com/2023/06/01/p9zkq81.png)](https://imgse.com/i/p9zkq81)

11. 在Report Template中，管理员可以为整个Plan的动态文档设定相关的Template，系统已经内置了多国语言版本的文档Template，管理员也可以通过Microsoft Word来自定义这个Template，我们将会在后续的介绍中详细说明Template的创建和编辑方法。在这个步骤中，我们选择中文的默认模板。
[![p9zkOv6.png](https://s1.ax1x.com/2023/06/01/p9zkOv6.png)](https://imgse.com/i/p9zkOv6)

12. 在Report Scheduling步骤中，可以设定Plan Report的创建时间，也不做修改保持默认。
[![p9zkjKK.png](https://s1.ax1x.com/2023/06/01/p9zkjKK.png)](https://imgse.com/i/p9zkjKK)

13. 以上就是所有设定步骤，在Summary中查看详细设置后点击Finish就能完成创建。创建完成后，这个Plan将会出现在Orchestration Plan的页面中。


## 管理Orchestration Plan
对于创建好的Plan，管理员可以对它做以下操作：

Launch ：Run、Halt、Undo和Schedule

Manage：Enable、Disable、New、Edit、Reset、Delete和Properties

Verity：Datalab test和Readiness check

Report操作

一般来说，新创建的Orchestration Plan是处于Disable状态，也就是前面的图标是灰色的，需要点击Manage->Enable选项来激活它才能正常工作。

做了恢复或者故障切换操作之后，管理员需要通过Manage->Reset按钮来重制这个Plan使其能继续工作，或者管理员还可以删除之前已经完成的Plan，重新定义新的Plan。

以上就是今天的内容，Orchestration Plan的基本创建方法，今天的例子中只是简单介绍了Restore Plan的方法，剩下的其他四种Plan留给大家自己探索。







