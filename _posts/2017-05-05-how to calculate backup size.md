---
layout: post
title: 数据中心备份容量和带宽的计算方法
tags: 数据备份
categories: Veeam小工具
---



常常在工作中被问及，你们备份软件，重删效果如何？备份数据占多少空间？其实，就效果而言，这往往会和数据类型以及存放方式直接相关，不同的方式以及不同的设备类型，产生的实际效果差异非常大，因此这个问题说实话是非常难用一句话来回答。但是，无论如何，备份数据是需要磁盘空间进行存储的，在备份项目的设计过程中，必然会有备份存储库的容量设计。通常这个设计会直接关系到用户的存储成本、存储效率以及备份的可用性，因此这个设计在备份项目中非常关键，尽可能准确的设计存储容量和带宽，直接关系到项目的成败。



这里我会以一个典型的虚拟化环境为例来说明应该如何去进行这个计算。

环境信息：

ESXi Host ：25台

VM：500个

每个VM平均磁盘容量：200GB

总Datastore使用容量：100TB



**带宽设计**

通常来说，备份过程中会有全备份和增量备份两种模式，一般情况下，首次备份是全备份，它将传输虚拟化环境中的所有数据至备份存储设备，因此这个传输量几乎为所有的Datastore的使用量；而后续的所有传输则是增量备份，传输的是虚拟化环境中的变化量，常见比较多的是每日变化量，本文暂时按照每日作为变化量的单位来计算。

每个环境中，每日的变化量可以根据Veeam ONE的变化评估报告获取，是相对准确的数值，我这里假设这个变化量为7%。所以我们的到以下数值：

首次传输数据量 ： 100TB

每天增量传输数据量：7TB

开启Veeam的优化压缩重删后，假设这个重删能够达到常规的效果，实际传输数据为datastore容量的50%：

首次真实传输数据量：50TB

每天真实传输数据量：3.5TB

因此我们需要的带宽计算如下，假设首次传输，我们可以开启周六24小时连续传输而后续增量备份则在每天业务空闲时20:00PM~6:00AM进行，除去备份作业的基础配置耗时后，我们大约估算实际数据传输时间为总耗时的80%，也就是10小时的备份工作时间内2小时为备份基础配置和等待时间，8小时为实际数据传输时间。因此简单的计算公式示例如下：

全备份需要带宽：50*1024*8/(24*3600*80%)=5.93Gbps

增量备份需要带宽：3.5*1024*8/(10*3600*80%)=1Gbps

以上，我们可以看到这样的一个大概状况，那么在网络上和磁盘上的读写吞吐量可以按照这个数据去进行规划，配置相应数量的网卡/HBA卡以实现以上这样的一个备份吞吐量。



**容量设计**

根据不同的备份模式，在数据存储无任何重删技术的情况下，这个容量设计是最容易进行计算的，以下将以最常见的常见常规增量备份为例来说明计算方法，这也是一个比较简单的计算题。

至少保留14份备份数据，每周执行1次全备份，每天进行1次增量备份。

| 格式               | 天   | 大小    |
| ------------------ | ---- | ------- |
| 全备份             | 1    | 50 TB   |
| 增量               | 2    | 3.5TB   |
| 增量               | 3    | 3.5TB   |
| 增量               | 4    | 3.5TB   |
| 增量               | 5    | 3.5TB   |
| 增量               | 6    | 3.5TB   |
| 增量               | 7    | 3.5TB   |
| 全备份             | 8    | 50 TB   |
| 增量               | 9    | 3.5TB   |
| 增量               | 10   | 3.5TB   |
| 增量               | 11   | 3.5TB   |
| 增量               | 12   | 3.5TB   |
| 增量               | 13   | 3.5TB   |
| 增量               | 14   | 3.5TB   |
| 全备份             | 15   | 50 TB   |
| 增量               | 16   | 3.5TB   |
| 增量               | 17   | 3.5TB   |
| 增量               | 18   | 3.5TB   |
| 增量               | 19   | 3.5TB   |
| 增量               | 20   | 3.5TB   |
| 总容量估算：       |      | 209.5TB |
| +15%缓存剩余容量： |      | 31.4TB  |
| 总计预估容量：     |      | 240.9TB |



这就是常规的备份容量的设计思路，在这里我还有一个非常棒的工具推荐给大家，这是Veeam国外的同事制作的Veeam备份存储库容量规划工具，在这个工具中有更全面更详细的计算方法，可以根据实际情况输入更多数据来进行计算。这个在线工具地址如下，推荐在电脑上打开会比较好：

http://vee.am/rps