# 无代理备份和应用程序感知


虚拟化技术是一个彻底改变 IT 世界的技术，同样在备份领域随着虚拟化技术的使用引入的无代理备份概念也不断对传统技术带来冲击。但是作为一对互相矛盾的技术 - 代理备份和无代理备份，其各自的优缺点也是相当明显。然而 Veeam 的无代理备份技术则是发挥了两者绝大多数的优势，实现了无代理备份的同时能感知应用程序。

**什么是代理（Software Agent）？**

这个 IT 专业词汇其实在中文上来说，并没办法给出很好很明确的定义，以致我们日常在技术交流的时候会含糊其辞，有时候会谈广义的代理，有时候会谈狭义的代理。我试着去从百度百科找找代理的定义，结果还是无功而返。而在 wikipedia 上，倒是有 Software Agent 的定义，不过也只是通过大众的认知给了一些 Software Agent 的应具备的特性：

- 持续运行 - 通常会保持运行状态，即使空闲时候也会处于等待状态。
- 自动自主运行 - 无需人工干预和交互就能保持运行状态。
- 应用程序交互功能 - 能够和其他程序发生交互，激活其他模块、互相通讯、协同工作。

仔细琢磨了下，确实传统领域的代理备份，那些代理软件倒是符合这些 Agent 应具备的特性。

**Veeam 无代理备份和应用程序感知**

Veeam 的虚拟化备份技术，是不需要在任何的操作系统内安装任何这类的程序，因此备份不需要系统的运行状态。

而应用程序感知则是在备份过程中，Veeam 全自动的到操作系统内运行一个进程，完成相应的应用程序感知、一致性保障和文件系统一致性处理，之后关闭应用程序，退出执行。这一过程只是在备份执行过程中的一个可选进程，因此是完全不同于上述的代理程序。

所以，通常代理程序会面临的问题，对于备份代理一样会碰到：

- 需要不停的为新部署的虚拟机，手工安装代理程序（我们认为推送虽然方便，但也是“手工”的一种，避免不了远程/本地的配置工作）；
- 软件更新的时候，需要为每一台机器升级代理；
- 在长期大规模环境的运行过程中，还需要考虑拿个什么软件去监控这些代理，我们所谓代理保姆，就是干这事的，防止哪天这些代理突然不工作了也没人知道；
- 以上这些都是长期消耗计算资源的，包括 CPU、内存、网络、存储，并且很多时候是重复的消耗。

而 Veeam 的技术，在深入到应用程序层面的感知进程，仅仅是在备份启动那一刻运行几分钟后立刻被关闭退出，因此完全不存在以上提及的这些问题。**无需每次部署/无需更新/不用长期运行监控**。

更有意思的是，现在的 IT 世界是一个运行越多风险越大的世界。我们没有任何应用程序的时候，就是一个最最安全的状态，而每增加一个应用程序，就多一份被黑客、病毒、勒索软件攻击的风险。为每一个系统减少一份持续运行应用程序，就是为我们的系统安全增加一份保障。

另外，如果系统关机了，那么需要保持运行才能进行备份的代理程序就彻底歇菜了。备份目标 Offline，这是传统备份软件界面中常常见到的事情，这时候备份管理员能做的唯一事情就是去找到应用或者基础架构的管理员去启动这个操作系统。而对于无代理的技术，即使是系统关机的情况下，备份依然不受影响。而还原过程中，Veeam 的多样化的颗粒度恢复却依然可以手工执行，堪称是完美的备份和还原。

**传统代理的更多缺陷**

利用代理技术的数据备份，绝大多数依赖网络。当我们为了隔离安全，去架构 DMZ 区域，去进行严格的出入规则的时候，突然发现因为买备份这个保险，我们不得不需要有个数据流去 DMZ 区域完成数据的抽取，以致原先的完全隔离的架构被打破，苦心设计的完美架构失去了其原本的设计目标。

Veeam 的这种应用程序插入运行技术则完全不同于传统代理，在感知应用程序时，这个运行执行可以通过 VIX 在无网络连通的状态下进行 Hypervisor 层面的感知。因此，在 Veeam 的设计理念中，可以为那些 DMZ 区域的备份带来更多一份的安全。

