<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>VAO | Backup next cloud</title><meta name=keywords content><meta name=description content="2017年起，我陆续在微信公众号上开始发一些关于数据保护的话题，总感觉在公众号上的内容查询历史存档和内容并不是那么方便，于是决定将这些内容完整的整理一个博客网站，以后的内容我会在本站和微信公众号上同时发布。"><meta name=author content="Lei Wei"><link rel=canonical href=https://newblog.backupnext.cloud/tags/vao/><link crossorigin=anonymous href=/assets/css/stylesheet.min.2d6dbfc6e0f8a1db1c9d082a76dc11d094328cf63f247bbc2421dfaa7f2bb170.css integrity="sha256-LW2/xuD4odscnQgqdtwR0JQyjPY/JHu8JCHfqn8rsXA=" rel="preload stylesheet" as=style><link rel=icon href=https://newblog.backupnext.cloud/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://newblog.backupnext.cloud/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://newblog.backupnext.cloud/favicon-32x32.png><link rel=apple-touch-icon href=https://newblog.backupnext.cloud/apple-touch-icon.png><link rel=mask-icon href=https://newblog.backupnext.cloud/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><link rel=alternate type=application/rss+xml href=https://newblog.backupnext.cloud/tags/vao/index.xml><meta property="og:title" content="VAO"><meta property="og:description" content="2017年起，我陆续在微信公众号上开始发一些关于数据保护的话题，总感觉在公众号上的内容查询历史存档和内容并不是那么方便，于是决定将这些内容完整的整理一个博客网站，以后的内容我会在本站和微信公众号上同时发布。"><meta property="og:type" content="website"><meta property="og:url" content="https://newblog.backupnext.cloud/tags/vao/"><meta property="og:site_name" content="Backup next Cloud"><meta name=twitter:card content="summary"><meta name=twitter:title content="VAO"><meta name=twitter:description content="2017年起，我陆续在微信公众号上开始发一些关于数据保护的话题，总感觉在公众号上的内容查询历史存档和内容并不是那么方便，于是决定将这些内容完整的整理一个博客网站，以后的内容我会在本站和微信公众号上同时发布。"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://newblog.backupnext.cloud/ accesskey=h title="Lei Wei's blog (Alt + H)">Lei Wei's blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://newblog.backupnext.cloud/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://newblog.backupnext.cloud/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://newblog.backupnext.cloud/search/ title=Search><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>VAO</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>VAO基础入门（五） - 基础配置要点</h2></header><section class=entry-content><p>系列目录： VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析 在前几篇中，我们把VAO的基本架构、基本组件都盘点了一遍，所涉及到的内容都是在Administration中的设置，也就是具有VAO管理员权限的账户所能进行的操作。VAO的管理员可以在这里为每组应用分别设定不同的Scope，同时将这些Scope分派给相关的人员进行使用，利用这一特性，可以有效的进行分组和隔离，是不是有点类似多租户或者多用户？但是又有很大差异。
本篇内容针对之前所提到的这些配置，说明一些可能需要注意的地方。
基础架构 vCenter添加
在安装和初始化配置过程中，我们把vCenter添加入VAO了，这时候之前的帖子如果大家有印象，可能会留意到我都没有提到过内嵌的VBR和Veeam ONE的配置，实际上在初始化配置完成之后，VAO非常智能的将我们在初始化阶段填写的vCenter的信息写入到了VBR和Veeam ONE之中，因此我们不需要再次在VBR和Veeam ONE里面重新添加了。
VBR添加
在VAO中，可以管理多个VBR或Enterprise Manager副本，在管理非内嵌的VBR时，需要做的只是通过推送的方式在VAO的控制台上，将VAO Agent推送到VBR上即可接管该VBR。这个操作也相当简单，通过这样的方式，可以很方便的管理到一个大规模的备份/灾备环境。
Active Directory
在项目实施中，往往很多用户环境没有Active Directory，而VAO又必须要有AD才能工作，这时候特别头疼，但是回过来其实这事情却又很简单。大家可以想想VDI的项目，也都是必须AD才能工作的，那他们那些项目不都得急死了？那倒不会的，因为很简单，没有AD我们就造个AD嘛，为了项目成功，没有条件创造个条件呗，这事完全难不倒我们这些攻城狮。
Scope Scope特别难理解，但是想通了又特别简单，因此这个配置要点说明，我强烈建议大家回过去到我的第三篇，加强理解下Scope的概念，并且通过实战，到VAO中设置一些复杂的场景来理解这个Scope。只有真枪实弹动过手，才能把这个Scope吃透，才能用好VAO，这是最最关键的一个组件。
另外，对于Scope，不能仅仅从Users and Scopes中去看这个Scopes，需要从Scopes的2个维度结合起来看，这样这个概念才会生动的显现在我们面前：
授权使用这个Scope的用户； Scope包含的5大Components和对应的DataLabs； Datalabs 请先理解VBR中所有DataLab的配置，如果还不会配置VBR中的DataLab，那么将会玩不转VAO，因为这是VAO的必要组件和必要条件。
DataLabs的配置在VAO中几乎没有任何操作，只是通过Assign的动作分配给对应的Scope，在VAO中想知道自己的DataLabs是如何配置是件非常困难的事情，假如我们需要用到大量的DataLabs，这时候可能只能回到VBR中逐个逐个点开配置去查看，这个非常不科学。那么我在这里有个很不错的小技巧可以提供给大家，在VAO的DataLabs信息中，会从VBR上取得这个DataLabs的Name、Description、Platform和VBR Server Name，这时候大家完全可以利用好这个Description，只需要在VBR中创建DataLabs时，将Virtual Lab Summary的内容Copy出来，贴到这个Virtual Lab的Description中，这样这段关于该DataLabs的详细配置情况就会被读取到VAO中，那么我们也就能够很清楚的知道这个DataLabs的具体配置了。如下图，最终我的效果。
Recovery Locations 设置相对复杂，而且设置完成后就固化下来了，然而这个只是一个计算资源的逻辑组合，他实际上只存在于VAO之中，不管在vCenter、VBR还是VeeamONE之中都不会有这个Recovery Locations存在。因此这也是一个非常好的消息，这个Recovery Locations无论设置成什么样子，他都不会影响除了VAO之外的其他任何组件的正常运行。
小小的Tips给到大家，那就是任性的去设置Recovery Locations吧，放肆的组合吧，就算不会被实际的Orchestration Plan使用到，放在那边又何妨？难说哪天有需要就用到了呢？...</p></section><footer class=entry-footer>Lei Wei</footer><a class=entry-link aria-label="post link to VAO基础入门（五） -  基础配置要点" href=https://newblog.backupnext.cloud/post/2020-02-21-vao-guide-05/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>VAO基础入门（八） - Plan Step · 下篇</h2></header><section class=entry-content><p>系列目录： VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析 上一篇，我介绍了Plan Step的基本概况，今天我来详细分解下在Plan Step中的自定义脚本，我会通过一个脚本使用例子，来带大家使用一下自定义脚本。
创建和设置 配置自定义的脚本需要使用隶属于Administrators组的账户登入VAO平台。进入Administration控制台后，可以在Configuration下面找到Plan Steps，在这里可以管理所有的Plan Steps，当然除了创建自定义的Steps之外，也可以在这里对OOTB的那些Steps进行一些个性化的配置。
点击Add按钮即可进入添加向导，过程也非常简单，为它起个响亮的名字，比如：远程的骚操作测试。在File栏，点击Browse从当前的客户端上去选择制作好的powershell脚本吧。
点击Next进入Step Visibility步骤，如果不希望所有的灾备管理员都看到这个骚脚本的话，可以不勾上这个界面的复选框。
最后还是老样子，Summary总结一下，点Finish就创建完成了。但是，这只是创建完成，别想着就马上拿去用，这里特别敲黑板强调一下：
Custom Script可以有两种不同执行位置，一种是在灾备的机器上执行，另外一种是在VBR上执行。这个必须手工在创建完Plan Step之后点击这个Step名称，浏览到右边如图位置进行调整，默认值是在VBR上执行。比如我今天要做的这个测试就是需要调整一下，更改成In-Guest OS。
需要注意的是，这个Step的设置是全局的，也就是说，如果将这个Step提供给所有的Scope使用，那么这项配置内容是所有的Scope共享的，不能做计划任务中做更改。因此管理员如果有必要，需要做这个Plan Steps的管理页面中根据实际需求逐个定义。
Hello！My Script 那么接下来，让我们来配置一个Script跑一把吧。来个简单的，内容如下：
########### #Lei Wei - 02/28/20 # # # 这个脚本是骚操作的代表，请仔细往后看 # # v1.0 $S = Get-Date; Add-Content c:\vao_log.txt "$S - Recording date " 如果一切正常，在VAO中将会看到如下信息：...</p></section><footer class=entry-footer>Lei Wei</footer><a class=entry-link aria-label="post link to VAO基础入门（八） -  Plan Step · 下篇" href=https://newblog.backupnext.cloud/post/2020-02-28-vao-guide-08/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>VAO基础入门（六） - 成功灾备计划的第一步</h2></header><section class=entry-content><p>系列目录： VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析 通过之前的配置，我们的VAO就可以开始正常使用了，我们可以用Plan Authors角色的用户登入到VAO控制台上，在控制台中，将看到被授权允许能访问的Scopes，并且可以对这些Scopes中的对象进行操作，包括Orchestration Plan、DataLabs和Report。
要成功实现企业的灾备计划，达成企业的RPO和RTO，除了需要超级强大的计算资源和工具软件之外，对于这个灾备工具的了解和熟悉程度也是非常重要的一部分。对于VAO来说，本身是一款非常强大的软件，但是需要灾备管理员非常清楚的了解灾备计划的每一部分以及它的操作的预期结果。所以成功的灾备计划第一步，我们先来看看VAO是如何工作的。
在这里我先使用user1@sedemolab.local这个Plan Authors角色的账号登入VAO系统中。它将看到房间Scope A和房间Scope B
Orchestration Plan VAO中可以设定两类Orchestration Plan，分别是恢复计划和故障切换计划，分别对应VBR中的Backup和Replication功能。这两个计划是整个灾备和恢复的基础，所有自动化的操作过程都将会通过这个Plan加入到灾备中去。在这里，我建议首先第一步，尽可能的不要加入太复杂的自动化脚本，而是用系统自带的Plan Steps，用最少的流程来测试两类Plan，等到熟悉了系统的工作机制后，再来逐步逐步添加适合的自定义脚本。
创建Orchestration Plan，进入左边的Orchestration Plans，在右边内容显示区域，会看到顶部的一排4个按钮，其中在Manage按钮所在的下拉菜单中，可以找到New的按钮。通过这个按钮可以启动Orchestration Plan的创建向导。 2. 打开向导后，首先需要选取使用哪个Scope来创建这个Orchestration Plan，就像前几篇中提到，每个Scope中包含了灾备的一系列元素，而Orchestration Plan则是把这些元素组合起来，形成一个可执行的计划。所以每个Orchestration Plan是属于某个特定的Scope下的Plan。 选择房间（Scope A）后，点击下一步。
设定Plan Info，此处的内容一般来说按照实际的情况填写，这些都会在Report中被使用到。 选择Plan Type，即决定这将是个Restore操作还是Failover操作，两者的唯一区别是，如果是Restore Plan那么将会增加一个Recovery Location的选项，选择我们这Plan Components之前设置好的Location即可。 选择VM Groups，在当前Scope下能看到的所有可用VM Groups都会列在Available Group中，通过Add按钮将需要的Group添加至右边的Plan Groups窗格中。也可以通过View VMs来详细查看当前选定的VM Groups中所包含的VM。 在VM Recovery Options中，需要设置3个内容： If any VM recovery fails then：如果Plan中有多台VM需要恢复，假如其中有一台VM恢复失败，此选项决定了后续的Plan如何操作，可以继续执行计划恢复其他VM或者是直接停止计划。 Recover the VMs in each Group: 按顺序恢复还是同时恢复。如果选择Simultaneously是同时进行，如果是选择In Sequence则是按顺序执行。 Recover simultaneously max of VMs：选择合适的数量，默认是10个，一般来说，管理员需要根据自己的计算资源情况，合理选择，最好执行一些测试后最后决定这里的数量。 Restore VM Tags：这个复选框下有个⚠️，一般来说恢复至新位置成为一个新VM则大多是不会选择这个恢复Tags，避免和生产的VM混起来。 在VM Steps中，可以选择很多恢复过程中的可以用到的Steps，默认情况下，系统自动会选上Restore VM和Check VM Heartbeat这两个Step。我建议刚开始熟悉VAO的管理员逐项逐项的添加各种Step，以测试每一种操作的功能，确定了某个需要的Step之后，再将其设计到自己的最终Plan之中。 在VM被恢复之后，为了确保系统的可靠性，VAO还提供了立刻继续将恢复出来的VM备份起来的功能，在Protect VM Groups中勾选Protect VM Groups after restore并且选择合适的Template Job就行了。这里面的Template Job都是在Plan Component中所选择的。 对于灾备来说，非常非常重要的一个指标就是RTO和RPO了，通常在备份或者容灾软件中很少有看到这两个数值的设定，而在VAO中，灾备管理员可以为每个Plan来制定相应的RTO和RPO目标，如果达成这个目标，系统会显示绿色的状态，而如果无法达成这个目标，则会发出相应警告⚠️。 此项的设置，具体数值可以精细到分钟级别。 管理员还能在VAO中定义Orchestration Plan的报表，在Plan中只需要选择相关的模版即可，可以选择pdf或者word格式的报表。关于报表模版的设计，我将会在本系列的最后一节详细介绍。 选择完报表模版后，可以设定报表计划任务，个人感觉都是报表的内容，实际上没必要分成2个页面来设置，但是不管怎么样，根据VAO产品的设计，我们可以在这里设置每天报表的计划任务，需要注意的是，报表更新的任务是每天为频率的，只能选择每天的时间，不能有其他更多选择。 又是一个复选框占用一个页面，勾选之后，VAO会在Plan创建完成后立刻进行灾备资源的可用性检查，根据实际情况选择即可。 以上就是所有设定步骤，在Summary中查看详细设置后点击Finish就能完成创建。创建完成后，这个Plan将会出现在Orchestration Plan的页面中。 对于创建好的Plan，管理员可以对它做以下操作：...</p></section><footer class=entry-footer>Lei Wei</footer><a class=entry-link aria-label="post link to VAO基础入门（六） -  成功灾备计划的第一步" href=https://newblog.backupnext.cloud/post/2020-02-25-vao-guide-06/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>VAO基础入门（四） - 基本组件 · 下篇</h2></header><section class=entry-content><p>系列目录： VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析 Plan Components 以下这些组件，需要针对每个Scope进行设置，上一篇中已经介绍了具体设置位置，接下来我们来看看这些Components都有些什么以及他们的设置方法。
VM Groups VM Groups定义了在这个Scope下面，能管理哪些虚拟机，简单来说就是圈一个范围，哪些虚拟机是属于这个Scope可以操作的，我们的Orchestration Plan针对哪些生产的VM进行操作。
和简单的VM勾选不一样的是，在VAO中，我们没办法很自由的去随意选择哪台VM属于哪个Scope，在VAO中我们只能选择所谓的VM Groups。
然而很尴尬的是，VAO本身并不能创建任何的VM Groups，这些Groups是通过VAO内嵌的Veeam ONE中的Business View引擎来获取的。Business View的系统分组引擎是VAO中非常重要的一个组成部分，它的具体内容可以参考官网手册：
https://helpcenter.veeam.com/docs/vao/categorization/about.html?ver=20
https://helpcenter.veeam.com/docs/one/monitor/bv_categorization_model.html?ver=100
在Business View的分组引擎中有3种使用方式：
1. vSphere Tags 2. 通过.CSV文件导入 3. 通过VeeamONE的自定义分组策略 这3种方式并没有天然的特殊优劣，还是取决于IT管理员对哪种更熟悉，使用更便捷。
vSphere Tags 这个分组方式需要在vSphere上面进行，通过为不同的VM打入不同的Tags来实现分组，相同Tags名称的虚拟机会被归入同一个VM Groups中，而这个VM Groups的名称就是在vSphere中的Tags的名称。
这种分组方式无法在Veeam系统中做任何修改，只需要在vSphere上操作即可，操作完成后VAO中稍等一小段时间即可收到操作结果，这个操作是全自动的同步。
通过.CSV文件导入 可以手工或者自动进行，这个操作需要在VAO内嵌的VeeamONE上进行，打开VeeamONE Monitor的控制台，在Server Setting中可以找到Business View的标签卡，在这里分别有自动从.CSV文件同步的选项和手工立刻从.CSV文件做单次导入的选项。...</p></section><footer class=entry-footer>Lei Wei</footer><a class=entry-link aria-label="post link to VAO基础入门（四） -  基本组件 · 下篇" href=https://newblog.backupnext.cloud/post/2020-02-20-vao-guide-04/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://newblog.backupnext.cloud/tags/vao/>« Prev Page</a></nav></footer></main><footer class=footer><span>Copyright Lei Wei</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>