<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>VAO | Backup next cloud</title><meta name=keywords content><meta name=description content="2017年起，我陆续在微信公众号上开始发一些关于数据保护的话题，总感觉在公众号上的内容查询历史存档和内容并不是那么方便，于是决定将这些内容完整的整理一个博客网站，以后的内容我会在本站和微信公众号上同时发布。"><meta name=author content="Lei Wei"><link rel=canonical href=https://newblog.backupnext.cloud/tags/vao/><link crossorigin=anonymous href=/assets/css/stylesheet.min.2d6dbfc6e0f8a1db1c9d082a76dc11d094328cf63f247bbc2421dfaa7f2bb170.css integrity="sha256-LW2/xuD4odscnQgqdtwR0JQyjPY/JHu8JCHfqn8rsXA=" rel="preload stylesheet" as=style><link rel=icon href=https://newblog.backupnext.cloud/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://newblog.backupnext.cloud/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://newblog.backupnext.cloud/favicon-32x32.png><link rel=apple-touch-icon href=https://newblog.backupnext.cloud/apple-touch-icon.png><link rel=mask-icon href=https://newblog.backupnext.cloud/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><link rel=alternate type=application/rss+xml href=https://newblog.backupnext.cloud/tags/vao/index.xml><meta property="og:title" content="VAO"><meta property="og:description" content="2017年起，我陆续在微信公众号上开始发一些关于数据保护的话题，总感觉在公众号上的内容查询历史存档和内容并不是那么方便，于是决定将这些内容完整的整理一个博客网站，以后的内容我会在本站和微信公众号上同时发布。"><meta property="og:type" content="website"><meta property="og:url" content="https://newblog.backupnext.cloud/tags/vao/"><meta property="og:site_name" content="Backup next Cloud"><meta name=twitter:card content="summary"><meta name=twitter:title content="VAO"><meta name=twitter:description content="2017年起，我陆续在微信公众号上开始发一些关于数据保护的话题，总感觉在公众号上的内容查询历史存档和内容并不是那么方便，于是决定将这些内容完整的整理一个博客网站，以后的内容我会在本站和微信公众号上同时发布。"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://newblog.backupnext.cloud/ accesskey=h title="Lei Wei's blog (Alt + H)">Lei Wei's blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://newblog.backupnext.cloud/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://newblog.backupnext.cloud/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://newblog.backupnext.cloud/search/ title=Search><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>VAO</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>VAO基础入门（一） - 简介</h2></header><section class=entry-content><p>随着Veeam旗舰产品Veeam Availability Suite v10的发布，Veeam Availability Orchestrator(以下简称VAO)也会在不久更新为v3.0版本，目前来说VAO产品还是处于v2.0版本。对于绝大多数同学来说，可能这个产品非常神秘，看似功能非常高大上，但是也不知道如何使用，我的这个基础入门系列将会和大家分享一些本人对于VAO的一些研究。
什么是VAO？ 简单来说，他是VAS加强版。它需要和VAS一起工作，离不开VAS；VAO还需要和VMware vSphere一起工作，它仅限于支持VMware的虚拟化环境。
能够通过软件的设置，来保证企业实施的灾备基础架构的满足所要求的RPO和RTO； 能够尽可能自动化的完成灾备的切换过程，该操作同时支持备份存档和复制存档； 能够通过数据实验室，来确保灾备的精准可靠，所有灾备演练将在数据实验室中1:1的完整演练。 VAO替代了VBR中Recovery、Failover以及Surebackup的操作，可以说是对于这3个关键操作的进一步加强，在这些关键操作中，可以加入各种自定义的步骤和脚本，使之能够更加接近实际业务场景中的使用。对于管理员来说，合理的设计这3个操作中的额外步骤能极大程度的降低IT运维中灾备流程的复杂度。
VAO支持哪些场景使用？ VAO支持的数据中心从简单到复杂，都可以使用，以下仅简单从最基本的架构举两个例子：
单个数据中心 单个数据中心内，加入VAO的组件后，和原有VAS的架构几乎没有太大差别，所有VBR上的操作不会有任何改变，常规的所有备份恢复操作都在VBR上可以完成，而VAO则在这里开始担当关键业务的RPO和RTO的确保任务。通常来说关键业务出现宕机后，都会在原始位置实现恢复，因此也没有特别的专用资源用于恢复准备。
因此，在这种场景下，唯一需要改变的是选择一些关键的VM，由VAO来接管这些VM的RPO和RTO。
一主一备数据中心 稍微复杂点，也是很典型的场景，就是跨区域的主备数据中心，主中心承担生成业务，而备中心承担灾备业务。我们通常VAS的设计会将备份存档拷贝到灾备中心进行存放，也可能会将一些关键的VM直接1:1的复制到灾备中心。而这时候，在灾备中心的数据恢复流程都将可以被编制到VAO的Failover Plan或Recovery Plan中，同时这些Plan也将会被在相应的Datalabs中做完整的恢复演练。
这种场景下，原先VAS的架构也没有太大变化，和单数据中心非常相似，只是我们可以规划一部分资源专用于灾备恢复。
VAO支持的两种Plan VAO本身并不提供备份和复制功能，所有对于源数据的提取功能，都会在VAS/VBR中完成。VAO中提供了两种Plan：Restore Plan和Failover Plan。
Restore Plan 这是对应VBR中的Backup & Restore功能，所有对备份存档（.vbk，.vib，.vrb等）的恢复，都归为这一类。
Failover Plan 这是对应VBR中的Replication & Failover功能，所有对于Replicas的故障切换，都归为这一类。
这两种Plan支持的操作：
- DataLabs 测试 - 资源可用性测试 - 完整报告自动生成 - 一键式全自动恢复、故障切换 VAO额外支持的DataLabs功能 作为Veeam产品看家本领，DataLabs功能在VAO中也是极大增强，在VAO中不仅能将DataLabs用于以上两种Plan的测试，还能利用VAO中强大的脚本和步骤添加功能，自动化的生成各种复杂的用于测试的环境。通过这种增强，复杂的测试用例，复杂的环境部署工作将会被简化成一键式的按钮，极大提升DataLabs的使用效率。
以上就是VAO的简介，欢迎关注VAO基础入门系列，在最近一段时间我会陆续更新以下内容：
VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析</p></section><footer class=entry-footer>Lei Wei</footer><a class=entry-link aria-label="post link to VAO基础入门（一） -  简介" href=https://newblog.backupnext.cloud/post/2020-02-17-vao-guide-01/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>VAO基础入门（七） - Plan Step · 上篇</h2></header><section class=entry-content><p>系列目录： VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析 前一篇，我详细介绍了Orchestration Plan，在我们设计灾备计划时，可以从某个Application入手，从简到繁循序渐进的规划整个数据中心的灾备。
创建Orchestration Plan时默认情况下，为每个灾备计划内置了最基础的Step，而VAO的强大之处在于它能够添加各种Step，系统内置了一些常用的Step，管理员只需要根据自己实际的需求选择相应的Step，然后配置相关参数即可使用。
Out-of-the-box的Plan Steps 这些出厂自带的steps一共22个，大概可以分为这么几类：
恢复操作 - 2个
Datalab Lab验证操作：
- DataLab准备操作 - 1个 - 虚拟机基础验证 - 2个 - 应用验证 - 12个 通知操作 - 2个
虚拟机电源操作 - 2个
虚拟机服务启动操作 - 1个
这些操作基本没什么特别需要注意的地方，所以的内容都已经固化内置在系统中了，根据系统的提示，填入相关的内容即可。本文不详细展开逐个讨论这里每一个Step的参数配置方法，具体大家可以根据实际情况选择逐个测试。
Plan Step通用参数 在每个Plan Step中，都会包含一个最基础的Common Parameter，这是对于这个Plan Step执行的基本控制条件，包含以下内容：...</p></section><footer class=entry-footer>Lei Wei</footer><a class=entry-link aria-label="post link to VAO基础入门（七） -  Plan Step · 上篇" href=https://newblog.backupnext.cloud/post/2020-02-27-vao-guide-07/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>VAO基础入门（三） - 基本组件 · 上篇</h2></header><section class=entry-content><p>系列目录： VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析 VAO引入了一套非常特殊的概念，它为该产品中使用的组件定义了一系列名称，随着版本的更新和迭代，这里的组件和名称可能会发生一些变化。目前VAO的版本是v2.0，因此本文所述内容仅适用于v2.0之后的版本，而后续版本中如果有新的变化，我会在后续的更新中说明。
Scope 定义和用途 Scope是VAO的最核心的概念，在v2.0中首次引入了这个概念。每个Scope中包含了灾备中需要一系列元素，VAO把这些元素称为Plan Components：
- VM Groups - Recovery Locations - Plan Steps - Credentials - Template Jobs 打个比方，Scope是一间房间，那么在这个房间中所放置的各种家具就是以上这些Plan Components。对于灾备来说，以上这些Plan Components将会在Orchestration Plan中被具体使用到。可以说Orchestration Plan是将这些Plan Components有序的组合起来，最终可以让我们实现一键的灾备恢复。
另外，Scope中还有个非常特殊的Component – Datalab，每一个Datalab对应某个Scope中，也就是说，每个Scope都有一个或多个独立的属于自己的DataLab。
关于Plan Components和DataLab，将在VAO基础入门（四）- 基本组件 · 下篇中详细介绍。
分类和创建方式 VAO中的Scope可以大致分为两类，一类是系统内置的名称叫Default的Scope，这个Scope无法删除，无法修改名称，并且Administrator的Role会被包含在这个Scope中，在VAO的其他Scope中是无法选择添加Administrators Role。当您要授予任何用户执行Administration配置操作时，您就需要将该用户添加至Default Scope下的Administrators Role。还记不记得在前一篇推送中提到的初始化步骤，在初始化过程中所添加的用户，默认就会被添加到这个Administrators Role下面。当然我们可以来添加更多的用户到Administrator Role中。...</p></section><footer class=entry-footer>Lei Wei</footer><a class=entry-link aria-label="post link to VAO基础入门（三） -  基本组件 · 上篇" href=https://newblog.backupnext.cloud/post/2020-02-19-vao-guide-03/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>VAO基础入门（九） - 文档模板解析</h2></header><section class=entry-content><p>系列目录： VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析 本系列的最后一篇，我来介绍一下VAO的文档系统。
VAO能够全自动的为管理员生成灾备需要的系统文档，文档的内容为VAO系统自动根据Orchestration Plan的设置和执行自动生成。VAO文档系统的强大在于所有的内容系统根据配置和运行会全自动生成，因此管理员只需要专心关注自己的灾备即可，这些后续的基础保障，繁琐的文档制定，全部交给VAO来完成。
VAO生成的每个文档会包含两部分，第一部分是灾备管理员定义的Report Template；第二部分是系统根据Report Type生成的动态内容。无论什么类型的文档，在文档的开头部分都会使用Report Template中所定义的内容，而第二部分则根据Report Type不同自动填充相关内容。
我们先来看个实际的例子，了解一下什么是Report Template中的内容，什么是根据Report Type自动生成的，如下图：
左边是一个VAO最终生成的Readiness Check的Report，右边是我们在编辑器中打开的Report Template。可以看到红色框所示的内容就是来自于Report Template的，而图中左边文档的后半部分内容则是根据这个Report Type，自动产生的内容。
Report Type 先来说说这个Report Type，也许聪明的你，在前几篇介绍Orchestration Plan的时候已经有看到，在每个Plan的右键菜单或者工具栏上有一些Report可以生成，它们分别是：
Report类型 作用 Plan Definition Report 记录灾备计划设置详情 Readiness Check Report 灾备计划可用性检测报告，包含恢复目标位置和灾备中心的可用性检测 Datalab test Reort 数据实验室测试报告 Excution Report 灾备执行情况报告 这些Report就是VAO能够生成的所有Report文档，这些文档都会有一个VAO已经内置设计好的内容，能够和灾备管理员定义的Report Template组合起来，最终形成一份完整可以阅读的Report。...</p></section><footer class=entry-footer>Lei Wei</footer><a class=entry-link aria-label="post link to VAO基础入门（九） -  文档模板解析" href=https://newblog.backupnext.cloud/post/2020-03-02-vao-guide-09/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>VAO基础入门（二） - 安装与部署</h2></header><section class=entry-content><p>系列目录： VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析 VAO 安装包获取 Veeam官网可以直接下载VAO，直达电梯
这个安装包是一套完整的VAO套件，其中包括VAO主程序、内嵌的VBR以及内嵌的VeeamONE，需要注意的是，这个安装包虽然包含了内嵌的VBR和内嵌的VeeamONE但是这两个软件都无法被提取出来单独安装，这两个内嵌的软件都是VAO工作的必要组件，它们是跟着VAO一起工作的。
这两个内嵌的VBR和VeeamONE和正常的软件没有任何区别，在安装完VAO后可以以常规的访问方式访问使用，目前在这个安装包中包含的VBR是9.5U4版本，VeeamONE是9.5U4版本；在VAO安装完成后，使用VBR和VeeamONE的正常升级方式将这两个组件升级至9.5U4a或者4b的版本。
安装前提条件 非常重要的两点提示：
请不要在已经安装了VBR或者VeeamONE的服务器上安装VAO软件包。 请不要在域控制器上安装VAO软件包。 一般来说，我们建议不管您是否已经安装了VBR，如果是进行VAO的安装，都应该准备一台全新的Windows服务器来安装VAO的安装包。
安装完成后，您可以将您原来的VBR加入到VAO环境中来由VAO纳管，也可以使用VAO内嵌的VBR来进行常规的备份和复制任务。
其他更多的安装前提条件，请参考官网的前提条件说明。
安装过程 安装包是个ISO文件，通过挂载ISO的方式打开这个镜像后自动运行，可以找到VAO的安装按钮：
整个安装过程非常简单，和Veeam其他产品的安装一样，跟着向导无脑点完下一步就能做完最基础的安装，安装完成后，请务必将VBR 9.5U4a和VeeamONE 9.5U4a的补丁打上，这一步千万不要忘了，因为9.5U4a这个补丁修复了很多VAO碰到的问题。
关于VBR 9.5U4a的升级，同样也可以参考我之前的博文。
需要注意的是，在安装过程中会要求输入用户名密码，此处的用户名密码为VAO、VBR、VeeamONE的服务和它们的数据库需要使用的用户名密码，因此此密码要求的最小权限为这台VAO Server的Windows 本地管理员权限，隶属于本地Administrators组即可。
这个账号虽然和后续灾备所使用的灾备管理员的账号没有任何关系，但是在后续的初始化配置的第一步需要输入此账号来登入VAO的UI界面。
初始化配置 安装结束后，请不要去打开内置的VBR和VeeamONE的控制台，请立刻开始初始化配置，系统只有在初始化配置完成后才能够正常工作，进入初始化配置的界面请访问：https://VAOIP:9898/ 这时候浏览器会提示输入用户名密码，请使用上图安装时所用到的用户名密码作为初始化登入使用的用户名密码。特别注意，这个密码只在初始化配置时使用1次，在初始化配置完成后，将会使用初始化配置过程中设定的VAO灾备管理员的用户名密码。
登入账号后，系统进入初始化向导，Welcome页面中有些信息，有兴趣的话可以阅读一下，这页很简单，只需读完后点击Next。 输入一些VAO服务器的基础管理信息，这些信息在后续的文档模板中都会有用到。当然这些信息在配置完成后都能在Configuration中进行修改，不用担心填错。 此处需要填入VAO灾备管理员的账号，需要注意的是，此处的账号为初始化配置结束后登入VAO UI的灾备管理员的账号，此账号需要属于域账号，因此在整个VAO的部署中，Active Directory 是必要条件，如果环境中没有AD域，那就创建一个VAO专用的AD域吧。 请一定记住此处填入的灾备管理员的账号，在这个向导结束后，安装阶段使用的本地管理员账号将再也无法登入系统进行初始化配置，替代的是此处填入的账号。...</p></section><footer class=entry-footer>Lei Wei</footer><a class=entry-link aria-label="post link to VAO基础入门（二） -  安装与部署" href=https://newblog.backupnext.cloud/post/2020-02-18-vao-guide-02/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://newblog.backupnext.cloud/tags/vao/page/2/>Next Page »</a></nav></footer></main><footer class=footer><span>Copyright Lei Wei</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>