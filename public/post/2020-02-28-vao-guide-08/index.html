<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>VAO基础入门（八） - Plan Step · 下篇 | Backup next cloud</title><meta name=keywords content="VAO"><meta name=description content="系列目录：  VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析  上一篇，我介绍了Plan Step的基本概况，今天我来详细分解下在Plan Step中的自定义脚本，我会通过一个脚本使用例子，来带大家使用一下自定义脚本。
创建和设置 配置自定义的脚本需要使用隶属于Administrators组的账户登入VAO平台。进入Administration控制台后，可以在Configuration下面找到Plan Steps，在这里可以管理所有的Plan Steps，当然除了创建自定义的Steps之外，也可以在这里对OOTB的那些Steps进行一些个性化的配置。
点击Add按钮即可进入添加向导，过程也非常简单，为它起个响亮的名字，比如：远程的骚操作测试。在File栏，点击Browse从当前的客户端上去选择制作好的powershell脚本吧。
点击Next进入Step Visibility步骤，如果不希望所有的灾备管理员都看到这个骚脚本的话，可以不勾上这个界面的复选框。
最后还是老样子，Summary总结一下，点Finish就创建完成了。但是，这只是创建完成，别想着就马上拿去用，这里特别敲黑板强调一下：
Custom Script可以有两种不同执行位置，一种是在灾备的机器上执行，另外一种是在VBR上执行。这个必须手工在创建完Plan Step之后点击这个Step名称，浏览到右边如图位置进行调整，默认值是在VBR上执行。比如我今天要做的这个测试就是需要调整一下，更改成In-Guest OS。
需要注意的是，这个Step的设置是全局的，也就是说，如果将这个Step提供给所有的Scope使用，那么这项配置内容是所有的Scope共享的，不能做计划任务中做更改。因此管理员如果有必要，需要做这个Plan Steps的管理页面中根据实际需求逐个定义。
Hello！My Script 那么接下来，让我们来配置一个Script跑一把吧。来个简单的，内容如下：
########### #Lei Wei - 02/28/20 # # # 这个脚本是骚操作的代表，请仔细往后看 # # v1.0 $S = Get-Date; Add-Content c:\vao_log.txt &#34;$S - Recording date &#34; 如果一切正常，在VAO中将会看到如下信息："><meta name=author content="Lei Wei"><link rel=canonical href=https://newblog.backupnext.cloud/post/2020-02-28-vao-guide-08/><link crossorigin=anonymous href=/assets/css/stylesheet.min.2d6dbfc6e0f8a1db1c9d082a76dc11d094328cf63f247bbc2421dfaa7f2bb170.css integrity="sha256-LW2/xuD4odscnQgqdtwR0JQyjPY/JHu8JCHfqn8rsXA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://newblog.backupnext.cloud/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://newblog.backupnext.cloud/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://newblog.backupnext.cloud/favicon-32x32.png><link rel=apple-touch-icon href=https://newblog.backupnext.cloud/apple-touch-icon.png><link rel=mask-icon href=https://newblog.backupnext.cloud/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><meta property="og:title" content="VAO基础入门（八） -  Plan Step · 下篇"><meta property="og:description" content="系列目录：  VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析  上一篇，我介绍了Plan Step的基本概况，今天我来详细分解下在Plan Step中的自定义脚本，我会通过一个脚本使用例子，来带大家使用一下自定义脚本。
创建和设置 配置自定义的脚本需要使用隶属于Administrators组的账户登入VAO平台。进入Administration控制台后，可以在Configuration下面找到Plan Steps，在这里可以管理所有的Plan Steps，当然除了创建自定义的Steps之外，也可以在这里对OOTB的那些Steps进行一些个性化的配置。
点击Add按钮即可进入添加向导，过程也非常简单，为它起个响亮的名字，比如：远程的骚操作测试。在File栏，点击Browse从当前的客户端上去选择制作好的powershell脚本吧。
点击Next进入Step Visibility步骤，如果不希望所有的灾备管理员都看到这个骚脚本的话，可以不勾上这个界面的复选框。
最后还是老样子，Summary总结一下，点Finish就创建完成了。但是，这只是创建完成，别想着就马上拿去用，这里特别敲黑板强调一下：
Custom Script可以有两种不同执行位置，一种是在灾备的机器上执行，另外一种是在VBR上执行。这个必须手工在创建完Plan Step之后点击这个Step名称，浏览到右边如图位置进行调整，默认值是在VBR上执行。比如我今天要做的这个测试就是需要调整一下，更改成In-Guest OS。
需要注意的是，这个Step的设置是全局的，也就是说，如果将这个Step提供给所有的Scope使用，那么这项配置内容是所有的Scope共享的，不能做计划任务中做更改。因此管理员如果有必要，需要做这个Plan Steps的管理页面中根据实际需求逐个定义。
Hello！My Script 那么接下来，让我们来配置一个Script跑一把吧。来个简单的，内容如下：
########### #Lei Wei - 02/28/20 # # # 这个脚本是骚操作的代表，请仔细往后看 # # v1.0 $S = Get-Date; Add-Content c:\vao_log.txt &#34;$S - Recording date &#34; 如果一切正常，在VAO中将会看到如下信息："><meta property="og:type" content="article"><meta property="og:url" content="https://newblog.backupnext.cloud/post/2020-02-28-vao-guide-08/"><meta property="article:section" content="post"><meta property="og:site_name" content="Backup next Cloud"><meta name=twitter:card content="summary"><meta name=twitter:title content="VAO基础入门（八） -  Plan Step · 下篇"><meta name=twitter:description content="系列目录：  VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析  上一篇，我介绍了Plan Step的基本概况，今天我来详细分解下在Plan Step中的自定义脚本，我会通过一个脚本使用例子，来带大家使用一下自定义脚本。
创建和设置 配置自定义的脚本需要使用隶属于Administrators组的账户登入VAO平台。进入Administration控制台后，可以在Configuration下面找到Plan Steps，在这里可以管理所有的Plan Steps，当然除了创建自定义的Steps之外，也可以在这里对OOTB的那些Steps进行一些个性化的配置。
点击Add按钮即可进入添加向导，过程也非常简单，为它起个响亮的名字，比如：远程的骚操作测试。在File栏，点击Browse从当前的客户端上去选择制作好的powershell脚本吧。
点击Next进入Step Visibility步骤，如果不希望所有的灾备管理员都看到这个骚脚本的话，可以不勾上这个界面的复选框。
最后还是老样子，Summary总结一下，点Finish就创建完成了。但是，这只是创建完成，别想着就马上拿去用，这里特别敲黑板强调一下：
Custom Script可以有两种不同执行位置，一种是在灾备的机器上执行，另外一种是在VBR上执行。这个必须手工在创建完Plan Step之后点击这个Step名称，浏览到右边如图位置进行调整，默认值是在VBR上执行。比如我今天要做的这个测试就是需要调整一下，更改成In-Guest OS。
需要注意的是，这个Step的设置是全局的，也就是说，如果将这个Step提供给所有的Scope使用，那么这项配置内容是所有的Scope共享的，不能做计划任务中做更改。因此管理员如果有必要，需要做这个Plan Steps的管理页面中根据实际需求逐个定义。
Hello！My Script 那么接下来，让我们来配置一个Script跑一把吧。来个简单的，内容如下：
########### #Lei Wei - 02/28/20 # # # 这个脚本是骚操作的代表，请仔细往后看 # # v1.0 $S = Get-Date; Add-Content c:\vao_log.txt &#34;$S - Recording date &#34; 如果一切正常，在VAO中将会看到如下信息："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://newblog.backupnext.cloud/post/"},{"@type":"ListItem","position":2,"name":"VAO基础入门（八） -  Plan Step · 下篇","item":"https://newblog.backupnext.cloud/post/2020-02-28-vao-guide-08/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"VAO基础入门（八） -  Plan Step · 下篇","name":"VAO基础入门（八） -  Plan Step · 下篇","description":"系列目录：  VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析  上一篇，我介绍了Plan Step的基本概况，今天我来详细分解下在Plan Step中的自定义脚本，我会通过一个脚本使用例子，来带大家使用一下自定义脚本。\n创建和设置 配置自定义的脚本需要使用隶属于Administrators组的账户登入VAO平台。进入Administration控制台后，可以在Configuration下面找到Plan Steps，在这里可以管理所有的Plan Steps，当然除了创建自定义的Steps之外，也可以在这里对OOTB的那些Steps进行一些个性化的配置。\n点击Add按钮即可进入添加向导，过程也非常简单，为它起个响亮的名字，比如：远程的骚操作测试。在File栏，点击Browse从当前的客户端上去选择制作好的powershell脚本吧。\n点击Next进入Step Visibility步骤，如果不希望所有的灾备管理员都看到这个骚脚本的话，可以不勾上这个界面的复选框。\n最后还是老样子，Summary总结一下，点Finish就创建完成了。但是，这只是创建完成，别想着就马上拿去用，这里特别敲黑板强调一下：\nCustom Script可以有两种不同执行位置，一种是在灾备的机器上执行，另外一种是在VBR上执行。这个必须手工在创建完Plan Step之后点击这个Step名称，浏览到右边如图位置进行调整，默认值是在VBR上执行。比如我今天要做的这个测试就是需要调整一下，更改成In-Guest OS。\n需要注意的是，这个Step的设置是全局的，也就是说，如果将这个Step提供给所有的Scope使用，那么这项配置内容是所有的Scope共享的，不能做计划任务中做更改。因此管理员如果有必要，需要做这个Plan Steps的管理页面中根据实际需求逐个定义。\nHello！My Script 那么接下来，让我们来配置一个Script跑一把吧。来个简单的，内容如下：\n########### #Lei Wei - 02/28/20 # # # 这个脚本是骚操作的代表，请仔细往后看 # # v1.0 $S = Get-Date; Add-Content c:\\vao_log.txt \u0026#34;$S - Recording date \u0026#34; 如果一切正常，在VAO中将会看到如下信息：","keywords":["VAO"],"articleBody":"系列目录：  VAO基础入门（一）- 简介 VAO基础入门（二）- 安装与部署 VAO基础入门（三）- 基本组件 · 上篇 VAO基础入门（四）- 基本组件 · 下篇 VAO基础入门（五）- 基础配置要点 VAO基础入门（六）- 成功灾备计划的第一步 VAO基础入门（七）- Plan Step · 上篇 VAO基础入门（八）- Plan Step · 下篇 VAO基础入门（九）- 文档模板解析  上一篇，我介绍了Plan Step的基本概况，今天我来详细分解下在Plan Step中的自定义脚本，我会通过一个脚本使用例子，来带大家使用一下自定义脚本。\n创建和设置 配置自定义的脚本需要使用隶属于Administrators组的账户登入VAO平台。进入Administration控制台后，可以在Configuration下面找到Plan Steps，在这里可以管理所有的Plan Steps，当然除了创建自定义的Steps之外，也可以在这里对OOTB的那些Steps进行一些个性化的配置。\n点击Add按钮即可进入添加向导，过程也非常简单，为它起个响亮的名字，比如：远程的骚操作测试。在File栏，点击Browse从当前的客户端上去选择制作好的powershell脚本吧。\n点击Next进入Step Visibility步骤，如果不希望所有的灾备管理员都看到这个骚脚本的话，可以不勾上这个界面的复选框。\n最后还是老样子，Summary总结一下，点Finish就创建完成了。但是，这只是创建完成，别想着就马上拿去用，这里特别敲黑板强调一下：\nCustom Script可以有两种不同执行位置，一种是在灾备的机器上执行，另外一种是在VBR上执行。这个必须手工在创建完Plan Step之后点击这个Step名称，浏览到右边如图位置进行调整，默认值是在VBR上执行。比如我今天要做的这个测试就是需要调整一下，更改成In-Guest OS。\n需要注意的是，这个Step的设置是全局的，也就是说，如果将这个Step提供给所有的Scope使用，那么这项配置内容是所有的Scope共享的，不能做计划任务中做更改。因此管理员如果有必要，需要做这个Plan Steps的管理页面中根据实际需求逐个定义。\nHello！My Script 那么接下来，让我们来配置一个Script跑一把吧。来个简单的，内容如下：\n########### #Lei Wei - 02/28/20 # # # 这个脚本是骚操作的代表，请仔细往后看 # # v1.0 $S = Get-Date; Add-Content c:\\vao_log.txt \"$S - Recording date \" 如果一切正常，在VAO中将会看到如下信息：\n让我们变得更复杂一点 好在这个脚本实在太简单了，几乎不可能会出现报错，那么如果复杂一点，脚本成功或者报错，VAO能否捕获这些错误让我们的管理员能够更方便的知道系统发生了什么问题呢？请看以下代码：\n########### #Lei Wei - 02/27/20 # # # 这个脚本是骚操作的代表，请仔细往后看 # # v1.1 try { $S = Get-Date; Add-Content c:\\vao_log.txt \"$S - Recording date. \" Write-Host \"准确计时，骚操作成功\" } Catch { Write-Error \" 不知道哪里坏了，失败了！\" Write-Error $_.Exception.Message } 在更换成这个Powershell执行之后，可以看到如下VAO界面中的执行成功记录，除了记录成功失败，还将我设置中脚本中的信息同时传递到了VAO界面之中。\n更多参数传递 VAO所使用的脚本还可以更复杂，比如说，可以通过VAO传递一些参数给脚本。我们来继续修改上面的脚本，如下：\n########### #Lei Wei - 02/27/20 # # # 这个脚本是骚操作的代表，请仔细往后看 # # v1.2 Param( [Parameter(Mandatory=$true)] [string]$planName, [string]$text ) try { $S = Get-Date; Add-Content c:\\vao_log.txt \"$S - Recording date. \" Write-Host \"准确计时，骚操作成功\" Write-Host \"准确计时，骚操作成功，$planName，$text !\" } Catch { Write-Error \" 不知道哪里坏了，失败了！\" Write-Error $_.Exception.Message } 这个脚本中，我们配置了两个参数，$planName和$text，如果要在VAO中正确使用参数，并将相关参数传递给脚本，那么就需要我们为这个Plan Step加上额外的参数，这个可以通过Plan Step中右边的Add按钮来完成。\n需要注意的是，我们Add的参数，它的名称必须和脚本中的参数名称保持一致，才能够被正确的传递，如下图，我们设置了planName和text。\n这里planName的default值设置为$plan_name$，这个内容是VAO中系统自带的一些变量，在我们的传递参数中，可以直接使用。具体列表在点击Edit按钮时会直接弹出供我们选择。\n而$text，我们直接输入Default Value，而不是使用VAO内置的系统变量，输入的内容为：完成参数传递。\n最后让我们来看看这个脚本骚操作在Orchestration Plan中执行结果吧，我们的Step Details和Report中会出现什么：\n感觉怎么样，是不是觉得VAO很棒？赶紧动手试一试吧。\n","wordCount":"166","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Lei Wei"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://newblog.backupnext.cloud/post/2020-02-28-vao-guide-08/"},"publisher":{"@type":"Organization","name":"Backup next cloud","logo":{"@type":"ImageObject","url":"https://newblog.backupnext.cloud/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://newblog.backupnext.cloud/ accesskey=h title="Lei Wei's blog (Alt + H)">Lei Wei's blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://newblog.backupnext.cloud/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://newblog.backupnext.cloud/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://newblog.backupnext.cloud/search/ title=Search><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>VAO基础入门（八） - Plan Step · 下篇</h1><div class=post-meta>Lei Wei&nbsp;|&nbsp;<a href=https://github.com/Coku2015/Coku2015.github.io/blob/master/content/post/2020-02-28-VAO%20Guide%2008.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#%e7%b3%bb%e5%88%97%e7%9b%ae%e5%bd%95 aria-label=系列目录：>系列目录：</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e5%92%8c%e8%ae%be%e7%bd%ae aria-label=创建和设置>创建和设置</a></li><li><a href=#hellomy-script aria-label="Hello！My Script">Hello！My Script</a></li><li><a href=#%e8%ae%a9%e6%88%91%e4%bb%ac%e5%8f%98%e5%be%97%e6%9b%b4%e5%a4%8d%e6%9d%82%e4%b8%80%e7%82%b9 aria-label=让我们变得更复杂一点>让我们变得更复杂一点</a></li><li><a href=#%e6%9b%b4%e5%a4%9a%e5%8f%82%e6%95%b0%e4%bc%a0%e9%80%92 aria-label=更多参数传递>更多参数传递</a></li></ul></div></details></div><div class=post-content><h2 id=系列目录>系列目录：<a hidden class=anchor aria-hidden=true href=#系列目录>#</a></h2><ul><li><a href=https://blog.backupnext.cloud/_posts/2020-02-17-VAO-Guide-01/>VAO基础入门（一）- 简介</a></li><li><a href=https://blog.backupnext.cloud/_posts/2020-02-18-VAO-Guide-02/>VAO基础入门（二）- 安装与部署</a></li><li><a href=https://blog.backupnext.cloud/_posts/2020-02-19-VAO-Guide-03/>VAO基础入门（三）- 基本组件 · 上篇</a></li><li><a href=https://blog.backupnext.cloud/_posts/2020-02-20-VAO-Guide-04/>VAO基础入门（四）- 基本组件 · 下篇</a></li><li><a href=https://blog.backupnext.cloud/_posts/2020-02-21-VAO-Guide-05/>VAO基础入门（五）- 基础配置要点</a></li><li><a href=https://blog.backupnext.cloud/_posts/2020-02-25-VAO-Guide-06/>VAO基础入门（六）- 成功灾备计划的第一步</a></li><li><a href=https://blog.backupnext.cloud/_posts/2020-02-27-VAO-Guide-07/>VAO基础入门（七）- Plan Step · 上篇</a></li><li><a href=https://blog.backupnext.cloud/_posts/2020-02-28-VAO-Guide-08/>VAO基础入门（八）- Plan Step · 下篇</a></li><li><a href=https://blog.backupnext.cloud/_posts/2020-03-02-VAO-Guide-09/>VAO基础入门（九）- 文档模板解析</a></li></ul><p>上一篇，我介绍了Plan Step的基本概况，今天我来详细分解下在Plan Step中的自定义脚本，我会通过一个脚本使用例子，来带大家使用一下自定义脚本。</p><h2 id=创建和设置>创建和设置<a hidden class=anchor aria-hidden=true href=#创建和设置>#</a></h2><p>配置自定义的脚本需要使用隶属于Administrators组的账户登入VAO平台。进入Administration控制台后，可以在Configuration下面找到Plan Steps，在这里可以管理所有的Plan Steps，当然除了创建自定义的Steps之外，也可以在这里对OOTB的那些Steps进行一些个性化的配置。</p><p><img loading=lazy src=https://s2.ax1x.com/2020/02/27/3wzhTJ.png alt=3wzhTJ.png></p><p>点击Add按钮即可进入添加向导，过程也非常简单，为它起个响亮的名字，比如：<code>远程的骚操作测试</code>。在File栏，点击Browse从当前的客户端上去选择制作好的powershell脚本吧。</p><p><img loading=lazy src=https://s2.ax1x.com/2020/02/27/30MFTs.png alt=30MFTs.png></p><p>点击Next进入Step Visibility步骤，如果不希望所有的灾备管理员都看到这个骚脚本的话，可以不勾上这个界面的复选框。</p><p><img loading=lazy src=https://s2.ax1x.com/2020/02/27/308ao4.png alt=308ao4.png></p><p>最后还是老样子，Summary总结一下，点Finish就创建完成了。但是，这只是创建完成，别想着就马上拿去用，这里特别敲黑板强调一下：</p><p>Custom Script可以有两种不同执行位置，一种是在灾备的机器上执行，另外一种是在VBR上执行。这个必须手工在创建完Plan Step之后点击这个Step名称，浏览到右边如图位置进行调整，默认值是在VBR上执行。比如我今天要做的这个测试就是需要调整一下，更改成In-Guest OS。</p><p><img loading=lazy src=https://s2.ax1x.com/2020/02/27/30smI1.png alt=30smI1.png></p><p>需要注意的是，这个Step的设置是全局的，也就是说，如果将这个Step提供给所有的Scope使用，那么这项配置内容是所有的Scope共享的，不能做计划任务中做更改。因此管理员如果有必要，需要做这个Plan Steps的管理页面中根据实际需求逐个定义。</p><h2 id=hellomy-script>Hello！My Script<a hidden class=anchor aria-hidden=true href=#hellomy-script>#</a></h2><p>那么接下来，让我们来配置一个Script跑一把吧。来个简单的，内容如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#75715e>###########</span>
<span style=color:#75715e>#Lei Wei - 02/28/20</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># 这个脚本是骚操作的代表，请仔细往后看</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># v1.0</span>
 
$S = Get-Date;
 
Add-Content c:\vao_log.txt <span style=color:#e6db74>&#34;$S - Recording date &#34;</span>
</code></pre></div><p>如果一切正常，在VAO中将会看到如下信息：</p><p><img loading=lazy src=https://s2.ax1x.com/2020/02/27/30RZZD.jpg alt=30RZZD.jpg></p><h2 id=让我们变得更复杂一点>让我们变得更复杂一点<a hidden class=anchor aria-hidden=true href=#让我们变得更复杂一点>#</a></h2><p>好在这个脚本实在太简单了，几乎不可能会出现报错，那么如果复杂一点，脚本成功或者报错，VAO能否捕获这些错误让我们的管理员能够更方便的知道系统发生了什么问题呢？请看以下代码：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#75715e>###########</span>
<span style=color:#75715e>#Lei Wei - 02/27/20</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># 这个脚本是骚操作的代表，请仔细往后看</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># v1.1</span>

<span style=color:#66d9ef>try</span> {
$S = Get-Date;
Add-Content c:\vao_log.txt <span style=color:#e6db74>&#34;$S - Recording date. &#34;</span>
Write-Host <span style=color:#e6db74>&#34;准确计时，骚操作成功&#34;</span>
}
<span style=color:#66d9ef>Catch</span> {
Write-Error <span style=color:#e6db74>&#34; 不知道哪里坏了，失败了！&#34;</span>
Write-Error $_.Exception.Message
}
</code></pre></div><p>在更换成这个Powershell执行之后，可以看到如下VAO界面中的执行成功记录，除了记录成功失败，还将我设置中脚本中的信息同时传递到了VAO界面之中。</p><p><img loading=lazy src=https://s2.ax1x.com/2020/02/27/30Iizd.png alt=30Iizd.png></p><h2 id=更多参数传递>更多参数传递<a hidden class=anchor aria-hidden=true href=#更多参数传递>#</a></h2><p>VAO所使用的脚本还可以更复杂，比如说，可以通过VAO传递一些参数给脚本。我们来继续修改上面的脚本，如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#75715e>###########</span>
<span style=color:#75715e>#Lei Wei - 02/27/20</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># 这个脚本是骚操作的代表，请仔细往后看</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># v1.2</span>

<span style=color:#66d9ef>Param</span>(
[<span style=color:#66d9ef>Parameter</span>(<span style=color:#66d9ef>Mandatory</span>=$true)]
<span style=color:#66d9ef>[string]</span>$planName,
<span style=color:#66d9ef>[string]</span>$text
)

<span style=color:#66d9ef>try</span> {
$S = Get-Date;
Add-Content c:\vao_log.txt <span style=color:#e6db74>&#34;$S - Recording date. &#34;</span>
Write-Host <span style=color:#e6db74>&#34;准确计时，骚操作成功&#34;</span>
Write-Host <span style=color:#e6db74>&#34;准确计时，骚操作成功，$planName，$text !&#34;</span>
}
<span style=color:#66d9ef>Catch</span> {
Write-Error <span style=color:#e6db74>&#34; 不知道哪里坏了，失败了！&#34;</span>
Write-Error $_.Exception.Message
}
</code></pre></div><p>这个脚本中，我们配置了两个参数，$planName和$text，如果要在VAO中正确使用参数，并将相关参数传递给脚本，那么就需要我们为这个Plan Step加上额外的参数，这个可以通过Plan Step中右边的Add按钮来完成。</p><p>需要注意的是，我们Add的参数，它的名称必须和脚本中的参数名称保持一致，才能够被正确的传递，如下图，我们设置了planName和text。</p><p><img loading=lazy src=https://s2.ax1x.com/2020/02/28/307LtK.png alt=307LtK.png></p><p>这里planName的default值设置为$plan_name$，这个内容是VAO中系统自带的一些变量，在我们的传递参数中，可以直接使用。具体列表在点击Edit按钮时会直接弹出供我们选择。</p><p>而$text，我们直接输入Default Value，而不是使用VAO内置的系统变量，输入的内容为：完成参数传递。</p><p>最后让我们来看看这个脚本骚操作在Orchestration Plan中执行结果吧，我们的Step Details和Report中会出现什么：</p><p><img loading=lazy src=https://s2.ax1x.com/2020/02/28/307qk6.png alt=307qk6.png></p><p>感觉怎么样，是不是觉得VAO很棒？赶紧动手试一试吧。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://newblog.backupnext.cloud/tags/vao/>VAO</a></li></ul><nav class=paginav><a class=prev href=https://newblog.backupnext.cloud/post/2020-02-21-vao-guide-05/><span class=title>« Prev Page</span><br><span>VAO基础入门（五） - 基础配置要点</span></a>
<a class=next href=https://newblog.backupnext.cloud/post/2020-02-25-vao-guide-06/><span class=title>Next Page »</span><br><span>VAO基础入门（六） - 成功灾备计划的第一步</span></a></nav></footer></article></main><footer class=footer><span>Copyright Lei Wei</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>